# NABA-next-icons

This project aims to describe and explain spatio-temporal abundance trends for North American butterfly abundance with the hope of identifying at-risk species in need of conservation attention. It is widely recognized that insect populations are experiencing threats from a wide variety of factors, but responses to these stressors varies considerably across species. Focusing on butterflies, we aim to quantify spatial variation in trends, link butterfly traits to trends, test whether butterfly traits mediate responses to changes in climate and land use, and then propose a few "next icon" possibilities for butterflies that might serve as a flagship species of conservation. By identifying important traits and how these traits mediate responses to rapid climate change and land use, we can obtain generalities about which species are vulnerable to "anthropogenic / capitalogenic" stressors. This analysis shares similarities with that published in [Crossley et al. (2021)](https://doi.org/10.1111/gcb.15582), but differs in several respects. First, we implement a modeling approach that keeps the spatio-temporal structure of the data intact. Second, [new trait data](https://doi.org/10.6084/m9.figshare.c.5899187.v1) and newly assembled trait data here open up new hypotheses to be tested. And lastly, we use census sites to make inference about broader areas that share ecological and political characteristics, with the hopes of getting a better estimate of species-level trends across a wider geographic area.

To do this, we are using the North American Butterfly Association (NABA) dataset generated by citizen scientists who perform yearly butterfly censuses all across the United States and Canada. We employ a space-time model that uses census data to make inference about species abundance at the "analytic strata" level (Bird Conservation Regions\*State/Provincial Boundaries), and abundance estimates borrow information from neighboring strata and the previous years. Estimates of abundance (+uncertainties) are used as input into other models to 1) obtain overall trends across the continent, 2) link trends to traits, and 3) link spatio-temporal variation in abundance to traits and climate and land use change. We incorporate butterfly phylogeny to account for phylogenetic dependencies. We then discuss a few species that seem particularly vulnerable and potentially in need of conservation attention.

1.  [curate.R](curate.R) takes the original NABA data file (must pay fee to access) and performs the following:

-   gets all site by year by species combinations and adds zeros for species that were not observed at a site for a given year--this will be used to filter sites later
-   because we are focused on summer breeding populations, we removed observations that occurred outside of the following time window: June 1st to August 31st
-   writes data to csv file

2.  [spacetime_v1.R](spacetime_v1.R) and [spacetime_v1_single stratum.R](spacetime_v1_single%20stratum.R) remove sites where fewer than 5 occurrences were recorded, then runs the space-time model for species with recorded occurrences for multiple vs a single stratum, respectively. I could have coded this more elegantly to reduce the number of scripts, but I don't have time to clean it up, so they're separate files. Essentially, for species occurring across multiple strata, we allow abundance estimates for a stratum to borrow information from neighboring strata, whereas for single stratum species we don't have a spatial effect. For all models, we correct for sampling effort, include an unstructured site-level random effect, and a random walk component so that information can be borrowed in time as well. See manuscript for more details. These scripts produce abundance estimates (+ uncertainties--by sampling posteriors 5000 times) for each species by year by stratum combination. This is then used to as raw input into the covariate analysis, as well as to compute trends for half-life calculations (3) and the trait analysis (4).

3.  Output from 2 was used to calculate annual change rates (across the 23 years of data) for each of the 5000 draws of abundance from the model described in 2, producing a distribution of trends for each species that can be used to calculate the "half-life" of a species--that is, the number of years it takes a species to decrease in abundance by 50%. The IUCN categorizes species of concern using thresholds for 10-year change estimates (TYC). I converted these TYC thresholds to half life estimates, and then re-categorized each of the species modeled here accordingly, focusing on the species with "significantly" negative annual change estimates. This is all done in [applying IUCN criteria.R](applying%20IUCN%20criteria.R).

4.  The different sources of trait data are compiled alongside the phylogeny of butterflies in [curate_traits and phylogeny.R](curate_traits%20and%20phylogeny.R). The objects are saved in [traits and phylo.RData](traits%20and%20phylo.RData). Voltinism and range size were computed in [traits_range size and voltinism extraction.R](data/traits/traits_range%20size%20and%20voltinism%20extraction.R) from brood maps produced in [Glassberg's butterfly guide](https://press.princeton.edu/books/paperback/9780691176505/a-swift-guide-to-butterflies-of-north-america).

5.  We downloaded climate data from [CRU-TS](https://crudata.uea.ac.uk/cru/data/hrg/) and land use data from [HILDA+](https://download.pangaea.de/dataset/921846/files/HILDAplus_GLOBv-1.0-f_netcdf_documentation.pdf). Each was processed in [climate extraction.R](climate%20extraction.R) and [land use extraction.R](land%20use%20extraction.R) to produce year by stratum estimates of climate and land use variables for the duration of the NABA census data (producing [climate by strata and year.csv](data/climate/climate%20by%20strata%20and%20year.csv) and [lulc_by year and strata.csv](data/land%20use/lulc_by%20year%20and%20strata.csv)). Because we want to test the hypothesis that climate and land use effects over time depend on the mean climate and land use condition (i.e., increased temperature in already hot vs cold areas likely to have different impacts), the means for each stratum are prepared in [climate and land use means and trends_wide.csv](data.climate%20and%20land%20use%20means%20and%20trends_wide.csv).

6.  We compared traits via model selection in [traits_model selection.R](traits_model%20selection.R), producing a WAIC table: [butterfly trends vs traits_strata_aic table_with phylogeny_all traits.csv](tables/butterfly%20trends%20vs%20traits_strata_aic%20table_with%20phylogeny_all%20traits.csv).

7.  Based on results of 6, we then created a list of plausible models containing voltinism, climate variables, land use variables, and reasonable interactions in [model comparison list.R](model%20comparison%20list.R). These models were compared in [climate and land use model selection.R](climate%20and%20land%20use%20model%20selection.R), producing a WAIC table: [butterfly trends vs covariates and traits_aic table_long.csv](tables/butterfly%20trends%20vs%20covariates%20and%20traits_aic%20table_long.csv). The top model was stored in [top model.RData](top model.RData), inspected, and figures for key results were produced in [top model_view and plot.R](top%20model_view%20and%20plot.R).

8.  Supplementary files:
